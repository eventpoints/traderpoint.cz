{% extends 'base.html.twig' %}

{% block body %}
    <div class="container min-vh-100">
        <div class="row justify-content-center g-3 mt-3">

            <div class="col-12 col-md-4">
                <div class="card">
                    <div class="card-header fs-4 d-flex justify-content-between align-items-center flex-wrap">
                        <div>{{ engagement.title }}</div>
                        <div class="badge text-bg-primary rounded-pill text-white">{{ (engagement.budget / 100)|format_currency(engagement.currencyCodeEnum.value, {}, 'en') }}</div>
                    </div>
                    {{ ux_map(map, { style: 'height: 250px' }) }}
                    {% if app.user != engagement.owner %}
                        <div class="card-header d-flex flex-wrap gap-2">
                            <div>
                                <img class="rounded-circle avatar-50" src="{{ engagement.owner.avatar }}">
                            </div>
                            <div>
                                <div>{{ engagement.owner.fullName|title }}</div>
                                <div>{{ engagement.createdAt.diffForHumans }}</div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <div data-controller="read-more"
                             data-read-more-more-text-value="{{ 'read-more'|trans }}"
                             data-read-more-less-text-value="{{ 'read-less'|trans }}">
                            <div class="read-more-content" data-read-more-target="content">
                                {{ engagement.description|nl2br }}
                            </div>
                            {% if engagement.description|length > 200 %}
                                <div class="text-center text-muted">
                                    <a class="hover-pointer"
                                       data-action="read-more#toggle">{{ 'read-more'|trans }}</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 justify-content-start" {{ stimulus_controller('lightbox') }}>
                            {% for image in engagement.images %}
                                <div href="{{ asset('uploads/images/' ~ image.filename) }}" class="col-6">
                                    <img src="{{ asset('uploads/images/' ~ image.filename) }}"
                                         class="img-fluid rounded-3 hover-pointer"/>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-12 col-md-6 mb-5">
                <div class="fs-4 mb-3">{{ 'received-quotations'|trans|title }}</div>
                <div class=" vstack gap-3">
                    {% if engagement.quote %}
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="fs-4">{{ engagement.quote.priceNetCents|format_currency(engagement.quote.currency.value) }}</div>
                                    <div>{{ engagement.quote.startAt|format_datetime }}</div>
                                </div>
                                <div>
                                    <span class="badge text-bg-success rounded-pill">{{ engagement.quote.status.value|trans }}</span>
                                </div>
                            </div>
                            <div class="card-header">
                                <div class="d-flex flex-wrap gap-2">
                                    <div>
                                        <img class="rounded-circle avatar-50" src="{{ engagement.quote.owner.avatar }}">
                                    </div>
                                    <div>
                                        <div>{{ engagement.quote.owner.fullName|title }}</div>
                                        <div>{{ engagement.quote.createdAt.diffForHumans }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-header">
                                <span class="badge rounded-pill text-bg-dark">{{ engagement.quote.startAt|format_datetime }}</span>
                                <span class="badge rounded-pill text-bg-dark">{{ 'duration-in-hours'|trans({duration: engagement.quote.expectedDurationHours}) }}</span>
                                <span class="badge rounded-pill text-bg-dark">{{ engagement.quote.includesMaterials ? 'includes-materials'|trans : 'does-not-includes-materials'|trans }}</span>
                                <span class="badge rounded-pill text-bg-dark">{{ 'warranty-duration-in-months'|trans({duration: engagement.quote.warrantyMonths}) }}</span>
                            </div>
                            <div class="card-body">{{ engagement.quote.message|nl2br }}</div>
                        </div>

                    {% else %}
                        {% for quote in quotes %}
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-start">
                                    <div class="fs-4 {{ quote.isRjectedExpiredOrwithdrawn ? 'strikethrough text-muted' }}">{{ quote.priceNetCents|format_currency(quote.currency.value) }}</div>
                                    <div class="fs-4">
                                        <span class="badge text-bg-primary rounded-pill">{{ quote.status.value|trans }}</span>
                                    </div>
                                </div>
                                <div class="card-header fs-4 d-flex flex-wrap gap-2">
                                    <span class="badge rounded-pill text-bg-dark">{{ quote.startAt|format_datetime }}</span>
                                    <span class="badge rounded-pill text-bg-dark">{{ 'duration-in-hours'|trans({duration: quote.expectedDurationHours}) }}</span>
                                    <span class="badge rounded-pill text-bg-dark">{{ quote.includesMaterials ? 'includes-materials'|trans : 'does-not-includes-materials'|trans }}</span>
                                    <span class="badge rounded-pill text-bg-dark">{{ 'warranty-duration-in-months'|trans({duration: quote.warrantyMonths}) }}</span>
                                </div>
                                <div class="card-body">{{ quote.message|nl2br }}</div>
                                <div class="list-group list-group-flush">
                                    <a href="{{ path('trader_profile', {id: quote.owner.id}) }}"
                                       class="list-group-item list-group-item-action">
                                        <div class="d-flex flex-wrap gap-2">
                                            <div>
                                                <img class="rounded-circle avatar-50" src="{{ quote.owner.avatar }}">
                                            </div>
                                            <div>
                                                <div>{{ quote.owner.fullName|title }}</div>
                                                <div>{{ quote.createdAt.diffForHumans }}</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                {% if quote.isUnanswered %}
                                    <div class="card-footer d-flex gap-3 justify-content-end align-items-center">
                                        <a href="{{ path('reject_quote', {id: quote.id}) }}"
                                           class="btn btn-outline-danger rounded-pill">
                                            <i class="bi bi-x-lg fs-4"></i>
                                        </a>
                                        <a href="{{ path('accept_quote', {id: quote.id}) }}"
                                           class="btn btn-outline-success rounded-pill">
                                            <i class="bi bi-check-lg fs-4"></i>
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="text-center text-muted">{{ 'no-quotes-received'|trans }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

    </div>
{% endblock %}
